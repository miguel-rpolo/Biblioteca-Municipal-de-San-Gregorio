{% extends "base.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Panel de Administraci√≥n</h2>
    <a href="{{ url_for('activities.new_activity') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Nueva Actividad
    </a>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>T√≠tulo</th>
                <th>Tipo</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Estado</th>
                <th>Inscritos</th>
                <th>Asistencia</th>
                <th>Disponibles</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for item in activities_data %}
            <tr>
                <td>{{ item.activity.id }}</td>
                <td>
                    <strong>{{ item.activity.title }}</strong>
                    {% if item.activity.description %}
                    <br><small class="text-muted">{{ item.activity.description[:50] }}...</small>
                    {% endif %}
                </td>
                <td>
                    {% if item.activity.type %}
                    <span class="badge bg-info">{{ item.activity.type }}</span>
                    {% endif %}
                </td>
                <td>{{ item.activity.date }}</td>
                <td>{{ item.activity.time or '-' }}</td>
                <td>
                    {% if item.activity.status == 'abierta' %}
                    <span class="badge bg-success">Abierta</span>
                    {% elif item.activity.status == 'cerrada' %}
                    <span class="badge bg-warning">Cerrada</span>
                    {% elif item.activity.status == 'finalizada' %}
                    <span class="badge bg-secondary">Finalizada</span>
                    {% else %}
                    <span class="badge bg-light text-dark">Borrador</span>
                    {% endif %}
                </td>
                <td>
                    <strong>{{ item.enrolled_count }}</strong> / {{ item.activity.max_slots }}
                </td>
                <td>
                    {% if item.activity.status == 'finalizada' %}
                    {{ item.attended_count }} / {{ item.enrolled_count }}
                    {% else %}
                    <span class="text-muted">Pendiente</span>
                    {% endif %}
                </td>
                <td>
                    {% if item.available_slots > 0 %}
                    <span class="text-success">{{ item.available_slots }}</span>
                    {% else %}
                    <span class="text-danger">0</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{{ url_for('admin.view_enrollments', activity_id=item.activity.id) }}" 
                           class="btn btn-info" title="Ver inscritos">
                            üë•
                        </a>
                        <a href="{{ url_for('admin.edit_activity', activity_id=item.activity.id) }}" 
                           class="btn btn-warning" title="Editar">
                            ‚úèÔ∏è
                        </a>
                        <a href="{{ url_for('admin.export_enrollments', activity_id=item.activity.id) }}" 
                           class="btn btn-success" title="Exportar CSV">
                            üì•
                        </a>
                        <form method="POST" action="{{ url_for('admin.delete_activity', activity_id=item.activity.id) }}" 
                              style="display: inline;" 
                              onsubmit="return confirm('¬øEliminar esta actividad y todas sus inscripciones?');">
                            <button type="submit" class="btn btn-danger btn-sm" title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if not activities_data %}
<div class="alert alert-info">
    No hay actividades creadas. <a href="{{ url_for('activities.new_activity') }}">Crear la primera actividad</a>
</div>
{% endif %}

{% endblock %}
